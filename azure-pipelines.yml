# # Starter pipeline
# # Start with a minimal pipeline that you can customize to build and deploy your code.
# # Add steps that build, run tests, deploy, and more:
# # https://aka.ms/yaml

# trigger:
# - main

# pool:
#   vmImage: ubuntu-latest
#   name: default
  
# variables:
#   buildConfiguration: 'Release'

# # Steps to run in the pipeline
# steps:

# - script: dotnet pack -p Version=1.0.$(Build.BuildId)
#   displayName: 'Create NuGet Package'

# - script: dotnet nuget push --source "hello-world-feed" --api-key az $(System.DefaultWorkingDirectory)/bin/Release/dotnew-SonarQube.1.0.$(Build.BuildId).nupkg
#   displayName: 'publish NuGet Package'

  



trigger:
  - main

pool:
  vmImage: ubuntu-latest
  name: default

variables:
  buildConfiguration: 'Release'

stages:
  - stage: Build
    displayName: 'Build Stage'
    jobs:
      - job: BuildJob
        displayName: 'Build Job'
        steps:
          - script: |
              echo "Building the project..."
              # Add your build commands here
              dotnet build
            displayName: 'Build'

  - stage: CreatePackage
    displayName: 'Create Package Stage'
    dependsOn: Build
    jobs:
      - job: CreateNuGetPackage
        displayName: 'Create NuGet Package'
        steps:
          - script: |
              echo "##vso[task.setvariable variable=packageVersion;isOutput=true]1.0.$(Build.BuildId)"
              dotnet pack -p Version=$(packageVersion)
            name: SetPackageVersion

  - stage: PublishPackage
    displayName: 'Publish Package Stage'
    dependsOn: CreatePackage
    jobs:
      - job: PublishNuGetPackage
        displayName: 'Publish NuGet Package'
        variables:
          packageVersion: $[stageDependencies.CreatePackage.CreateNuGetPackage.outputs['SetPackageVersion.packageVersion']]
        steps:
          - script: |
              dotnet nuget push --source "hello-world-feed" --api-key az $(System.DefaultWorkingDirectory)/bin/Release/dotnew-SonarQube.$(packageVersion).nupkg
              echo "The newly created version is $(packageVersion)"

